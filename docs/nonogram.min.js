var nonogram=function(a){'use strict';function b(a,b){return a.length===b.length&&a.every((a,c)=>a===b[c])}function c(a){try{return n.createObjectURL(new Blob([a],{type:l}))}catch(c){var b=new m;return b.append(a),n.createObjectURL(b.getBlob(type))}}var d=Math.SQRT1_2,e=Math.PI,g=Math.min,f=Math.floor,h={greyVeryLight:'#ccc',grey:'#555',greyVeryDark:'#111',blue:'#0ebeff',green:'#47cf73',violet:'#ae63e4',yellow:'#fcd000',red:'#ff3c41'};const k={EMPTY:0,FILLED:1,UNSET:2,TEMP_FILLED:3,TEMP_EMPTY:4,INCONSTANT:5};class i{constructor(){this.theme={filledColor:h.grey,unsetColor:h.greyVeryLight,correctColor:h.green,wrongColor:h.red,meshColor:h.yellow,isMeshed:!1,isBoldMeshOnly:!1,isMeshOnTop:!1,boldMeshGap:5}}initCanvas(a){let b=a instanceof HTMLCanvasElement?a:document.getElementById(a);b instanceof HTMLCanvasElement||(b=document.createElement('canvas')),this.canvas=b,this.canvas.nonogram&&this.canvas.nonogram.listeners.forEach(([a,b])=>{this.canvas.removeEventListener(a,b)}),this.canvas.nonogram=this,this.canvas.width=this.theme.width||this.canvas.clientWidth,this.canvas.height=this.canvas.width*(this.m+1)/(this.n+1),this.ctx=this.canvas.getContext('2d')||new CanvasRenderingContext2D,this.initListeners(),this.listeners.forEach(([a,b])=>{this.canvas.addEventListener(a,b)}),this.canvas.oncontextmenu=(a)=>{a.preventDefault()}}initListeners(){this.listeners=[]}removeNonPositiveHints(){function a(a,b,c){c[b]=a.filter((a)=>0<a)}this.hints.row.forEach(a),this.hints.column.forEach(a)}getSingleLine(a,b){const c=[];if('row'===a)for(let a=0;a<this.n;a+=1)c[a]=this.grid[b][a];else if('column'===a)for(let a=0;a<this.m;a+=1)c[a]=this.grid[a][b];return c}calculateHints(a,b){const c=[],d=this.getSingleLine(a,b);return d.reduce((a,b)=>{if(b===k.FILLED)c.push(a?c.pop()+1:1);else if(b!==k.EMPTY)throw new Error;return b===k.FILLED},!1),c}isLineCorrect(a,c){try{return b(this.calculateHints(a,c),this.hints[a][c])}catch(a){return!1}}getLocation(a,b){const c=this.canvas.getBoundingClientRect(),e=c.width,f=c.height,g=2*e/3,h=2*f/3,i=g/(this.n+1);return 0>a||a>=e||0>b||b>=f?'outside':0<=a&&a<=g&&0<=b&&b<h?i/2<=a&&a<g-i/2&&i/2<=b&&b<h-i/2?'grid':'limbo':g<=a&&a<e&&h<=b&&b<f?'controller':'hints'}print(){this.printGrid(),this.printHints(),this.printController()}printGrid(){const{ctx:a}=this,{width:b,height:c}=this.canvas,e=2*b/3/(this.n+1);a.clearRect(-1,-1,2*b/3+1,2*c/3+1),this.theme.isMeshed&&!this.theme.isMeshOnTop&&this.printMesh(),a.save(),a.translate(e/2,e/2);for(let b=0;b<this.m;b+=1)for(let c=0;c<this.n;c+=1)a.save(),a.translate(e*c,e*b),this.printCell(this.grid[b][c]),a.restore();a.restore(),this.theme.isMeshed&&this.theme.isMeshOnTop&&this.printMesh()}printCell(a){const{ctx:b}=this,c=2*this.canvas.width/3/(this.n+1);a===k.UNSET?(b.fillStyle=this.theme.unsetColor,b.fillRect(0.05*c,0.05*c,0.9*c,0.9*c)):a===k.FILLED?(b.fillStyle=this.theme.filledColor,b.fillRect(0.05*-c,0.05*-c,1.1*c,1.1*c)):void 0}printMesh(){const{ctx:a}=this,b=2*this.canvas.width/3/(this.n+1);a.save(),a.translate(b/2,b/2),a.beginPath();for(let c=1;c<this.m;c+=1)this.theme.isBoldMeshOnly||(a.moveTo(0,c*b),a.lineTo(this.n*b,c*b)),0==c%this.theme.boldMeshGap&&(a.moveTo(0,c*b),a.lineTo(this.n*b,c*b),!this.theme.isBoldMeshOnly&&(a.moveTo(0,c*b-1),a.lineTo(this.n*b,c*b-1),a.moveTo(0,c*b+1),a.lineTo(this.n*b,c*b+1)));for(let c=1;c<this.n;c+=1)this.theme.isBoldMeshOnly||(a.moveTo(c*b,0),a.lineTo(c*b,this.m*b)),0==c%this.theme.boldMeshGap&&(a.moveTo(c*b,0),a.lineTo(c*b,this.m*b),!this.theme.isBoldMeshOnly&&(a.moveTo(c*b-1,0),a.lineTo(c*b-1,this.m*b),a.moveTo(c*b+1,0),a.lineTo(c*b+1,this.m*b)));a.lineWidth=1,a.strokeStyle=this.theme.meshColor,a.stroke(),a.restore()}printHints(){const{ctx:a}=this,{width:b,height:c}=this.canvas,e=2*b/3/(this.n+1);a.clearRect(2*b/3-1,-1,3*b+1,2*c/3+1),a.clearRect(-1,2*c/3-1,2*b/3+1,c/3+1),a.save(),a.translate(e/2,e/2);for(let a=0;a<this.m;a+=1){for(let b=0;b<this.hints.row[a].length;b+=1)this.printSingleHint('row',a,b);0===this.hints.row[a].length&&this.printSingleHint('row',a,0)}for(let a=0;a<this.n;a+=1){for(let b=0;b<this.hints.column[a].length;b+=1)this.printSingleHint('column',a,b);0===this.hints.column[a].length&&this.printSingleHint('column',a,0)}a.restore()}printSingleHint(a,b,c){const{ctx:e}=this,{width:f,height:g}=this.canvas,h=2*f/3/(this.n+1);e.textAlign='center',e.textBaseline='middle',e.font=`${h}pt "Courier New", Inconsolata, Consolas, monospace`;const d=this.hints[a][b];e.fillStyle=d.isCorrect?this.theme.correctColor:this.theme.wrongColor,e.globalAlpha=!d.isCorrect&&d.unchanged?0.5:1,'row'===a?e.fillText(`${this.hints.row[b][c]||0}`,2*f/3+h*c,h*(b+0.5),0.8*h):'column'===a&&e.fillText(`${this.hints.column[b][c]||0}`,h*(b+0.5),2*g/3+h*c,0.8*h)}}var j='undefined'==typeof Symbol?'__target':Symbol(),l='application/javascript',m=window.BlobBuilder||window.WebKitBlobBuilder||window.MozBlobBuilder||window.MSBlobBuilder,n=window.URL||window.webkitURL,p=window.Worker;if(p){var o,q=c('self.onmessage = function () {}'),r=new Uint8Array(1);try{if(/(?:Trident|Edge)\/(?:[567]|12)/i.test(navigator.userAgent))throw new Error('Not available');o=new p(q),o.postMessage(r,[r.buffer])}catch(a){p=null}finally{n.revokeObjectURL(q),o&&o.terminate()}}var s=new function(a,b){return function(d){var e=this;if(!b)return new p(a);if(p&&!d){var f=`${b}`.replace(/^function.+?{/,'').slice(0,-1),g=c(f);return this[j]=new p(g),n.revokeObjectURL(g),this[j]}var h={postMessage:(a)=>{e.onmessage&&setTimeout(()=>e.onmessage({data:a,target:h}))}};b.call(h),this.postMessage=(a)=>{setTimeout(()=>h.onmessage({data:a,target:e}))},this.isThisThread=!0}}('./worker.ts',function(){function a(a,b){return a.length===b.length&&a.every((a,c)=>a===b[c])}const b={EMPTY:0,FILLED:1,UNSET:2,TEMP_FILLED:3,TEMP_EMPTY:4,INCONSTANT:5},c=(a)=>a.reduce((c,a)=>c+a,0),d=new Map;d.set(b.TEMP_FILLED,b.FILLED),d.set(b.TEMP_EMPTY,b.EMPTY),d.set(b.INCONSTANT,b.UNSET);class e{constructor(a){this.scan=()=>{if(this.updateScanner()){this.delay&&(this.message={type:'update',grid:this.grid,scanner:this.scanner,hints:this.hints},postMessage(this.message)),this.isError=!0;const{direction:a,i:c}=this.scanner;this.currentHints=this.hints[a][c],this.currentHints.unchanged=!0,this.currentLine=this.getSingleLine(a,c);const d=this.currentLine.every((a)=>a!==b.UNSET);return d||(this.solveSingleLine(),this.setBackToGrid(this.currentLine)),this.isLineCorrect(a,c)&&(this.hints[a][c].isCorrect=!0,this.isError=!1),this.isError?(this.message={type:'error',grid:this.grid,scanner:this.scanner,hints:this.hints},void postMessage(this.message)):void(this.delay?setTimeout(this.scan,this.delay):this.scan())}},this.hints=a.hints,this.delay=a.delay,this.grid=a.grid,this.scanner={direction:'row',i:-1},this.possibleBlanks={row:[],column:[]},this.scan()}getSingleLine(a,b){const c=[],d=this.grid.length,e=this.grid.length&&this.grid[0].length;if('row'===a)for(let a=0;a<e;a+=1)c[a]=this.grid[b][a];else if('column'===a)for(let a=0;a<d;a+=1)c[a]=this.grid[a][b];return c}calculateHints(a,c){const d=[],e=this.getSingleLine(a,c);return e.reduce((a,c)=>{if(c===b.FILLED)d.push(a?d.pop()+1:1);else if(c!==b.EMPTY)throw new Error;return c===b.FILLED},!1),d}isLineCorrect(b,c){try{return a(this.calculateHints(b,c),this.hints[b][c])}catch(a){return!1}}updateScanner(){let a;do if(this.isError=!1,this.scanner.i+=1,void 0===this.hints[this.scanner.direction][this.scanner.i]&&(this.scanner.direction='row'===this.scanner.direction?'column':'row',this.scanner.i=0),a=this.hints[this.scanner.direction][this.scanner.i],this.hints.row.every((a)=>!!a.unchanged)&&this.hints.column.every((a)=>!!a.unchanged))return this.message={type:'finish',grid:this.grid,hints:this.hints},postMessage(this.message),!1;while(a.isCorrect||a.unchanged);return!0}setBackToGrid(a){const{direction:b,i:c}=this.scanner;'row'===b?a.forEach((a,b)=>{d.has(a)&&this.grid[c][b]!==d.get(a)&&(this.grid[c][b]=d.get(a),this.hints.column[b].unchanged=!1)}):'column'===b&&a.forEach((a,b)=>{d.has(a)&&this.grid[b][c]!==d.get(a)&&(this.grid[b][c]=d.get(a),this.hints.row[b].unchanged=!1)})}solveSingleLine(){this.isError=!0;const{direction:a,i:b}=this.scanner;void 0===this.possibleBlanks[a][b]&&(this.possibleBlanks[a][b]=[],this.findAll(this.currentLine.length-c(this.currentHints)+1)),this.merge()}findAll(a,b=[],c=0){if(c===this.currentHints.length){const a=b.slice(0,this.currentHints.length);a[0]-=1;const{direction:c,i:d}=this.scanner;this.possibleBlanks[c][d]&&this.possibleBlanks[c][d].push(a)}for(let d=1;d<=a;d+=1)b[c]=d,this.findAll(a-b[c],b,c+1)}merge(){const{direction:a,i:c}=this.scanner,d=this.possibleBlanks[a][c];d.forEach((a,c)=>{const e=[];for(let d=0;d<this.currentHints.length;d+=1)e.push(...Array(a[d]).fill(b.TEMP_EMPTY)),e.push(...Array(this.currentHints[d]).fill(b.TEMP_FILLED));e.push(...Array(this.currentLine.length-e.length).fill(b.TEMP_EMPTY));const f=e.some((a,c)=>a===b.TEMP_EMPTY&&this.currentLine[c]===b.FILLED||a===b.TEMP_FILLED&&this.currentLine[c]===b.EMPTY);return f?void delete d[c]:void(this.isError=!1,e.forEach((a,c)=>{a===b.TEMP_FILLED?this.currentLine[c]===b.TEMP_EMPTY?this.currentLine[c]=b.INCONSTANT:this.currentLine[c]===b.UNSET&&(this.currentLine[c]=b.TEMP_FILLED):a===b.TEMP_EMPTY&&(this.currentLine[c]===b.TEMP_FILLED?this.currentLine[c]=b.INCONSTANT:this.currentLine[c]===b.UNSET&&(this.currentLine[c]=b.TEMP_EMPTY))}))}),this.possibleBlanks[a][c]=d.filter((a)=>a)}}onmessage=({data:a})=>{new e(a)}});return a.Solver=class extends i{constructor(a,b,c,{theme:d={},delay:e=50,onSuccess:g=()=>{},onError:i=()=>{}}={}){super(),this.worker=new s,this.click=(a)=>{if(!this.isBusy){const b=this.canvas.getBoundingClientRect(),c=a.clientX-b.left,e=a.clientY-b.top,g=2*b.width/3/(this.n+1),d=this.getLocation(c,e);if('grid'===d){if(this.isError)return;const a=f(e/g-0.5),b=f(c/g-0.5);this.grid[a][b]===k.UNSET&&(this.grid[a][b]=k.FILLED,this.hints.row[a].unchanged=!1,this.hints.column[b].unchanged=!1,this.solve())}else'controller'===d&&this.refresh()}},this.theme.filledColor=h.green,this.theme.correctColor=h.green,this.theme.wrongColor=h.yellow,Object.assign(this.theme,d),this.delay=e,this.handleSuccess=g,this.handleError=i,this.hints={row:a.slice(),column:b.slice()},this.removeNonPositiveHints(),this.m=this.hints.row.length,this.n=this.hints.column.length,this.grid=Array(this.m);for(let f=0;f<this.m;f+=1)this.grid[f]=Array(this.n).fill(k.UNSET);this.initCanvas(c),this.print()}initListeners(){this.listeners=[['click',this.click]]}refresh(){this.grid=Array(this.m);for(let a=0;a<this.m;a+=1)this.grid[a]=Array(this.n).fill(k.UNSET);this.hints.row.forEach((a)=>{a.isCorrect=!1,a.unchanged=!1}),this.hints.column.forEach((a)=>{a.isCorrect=!1,a.unchanged=!1}),this.solve()}solve(){this.isBusy||(this.print(),this.isBusy=!0,this.startTime=Date.now(),this.worker.onmessage=({data:a})=>{if(this.canvas.nonogram!==this)return void this.worker.terminate();if(this.scanner=a.scanner,this.grid=a.grid,this.hints=a.hints,'update'!==a.type)if(this.isBusy=!1,'error'===a.type){this.isError=!0;const{direction:a,i:b}=this.scanner;this.handleError(new Error(`Bad hints at ${a} ${b+1}`))}else'finish'===a.type&&(this.isError=!1,this.handleSuccess(Date.now()-this.startTime));this.print()},this.worker.postMessage({delay:this.delay,grid:this.grid,hints:this.hints}))}print(){this.printGrid(),this.printHints(),this.printScanner(),this.printController()}printController(){const{ctx:a}=this,{width:b,height:c}=this.canvas,f=g(b,c)/4,h=this.theme.filledColor;a.clearRect(2*b/3-1,2*c/3-1,b/3+1,c/3+1),this.isBusy||(a.save(),a.translate(0.7*b,0.7*c),a.drawImage(function(){const a=document.createElement('canvas'),b=f/10;a.width=f,a.height=f;const g=a.getContext('2d')||new CanvasRenderingContext2D;return g.translate(f/2,f/2),g.rotate(Math.PI),g.arc(0,0,f/2-b/2,e/2,e/3.9),g.lineWidth=b,g.strokeStyle=h,g.stroke(),g.beginPath(),g.moveTo((f/2+b)*d,(f/2+b)*d),g.lineTo((f/2-2*b)*d,(f/2-2*b)*d),g.lineTo((f/2-2*b)*d,(f/2+b)*d),g.closePath(),g.fillStyle=h,g.fill(),a}(),0,0),a.restore())}printScanner(){if(this.scanner){const{ctx:a}=this,{width:b,height:c}=this.canvas,e=2*b/3/(this.n+1);a.save(),a.translate(e/2,e/2),a.fillStyle=this.isError?this.theme.wrongColor:this.theme.correctColor,a.globalAlpha=0.5,'row'===this.scanner.direction?a.fillRect(0,e*this.scanner.i,b,e):'column'===this.scanner.direction&&a.fillRect(e*this.scanner.i,0,e,c),a.restore()}}},a.Editor=class extends i{constructor(a,b,c,{theme:d={},grid:e=[],threshold:g=0.5,onHintChange:i=()=>{}}={}){super(),this.mousedown=(a)=>{const b=this.canvas.getBoundingClientRect(),c=a.clientX-b.left,e=a.clientY-b.top,g=2*b.width/3/(this.n+1),d=this.getLocation(c,e);if('controller'===d)this.refresh();else if('grid'===d){this.draw.firstI=f(e/g-0.5),this.draw.firstJ=f(c/g-0.5);const a=this.grid[this.draw.firstI][this.draw.firstJ];this.draw.brush=a===k.FILLED?k.EMPTY:k.FILLED,this.isPressed=!0,this.paintCell(this.draw.firstI,this.draw.firstJ),this.draw.lastI=this.draw.firstI,this.draw.lastJ=this.draw.firstJ}},this.mousemove=(a)=>{if(this.isPressed){const b=this.canvas.getBoundingClientRect(),c=a.clientX-b.left,e=a.clientY-b.top,g=2*b.width/3/(this.n+1);if('grid'===this.getLocation(c,e)){const a=f(e/g-0.5),b=f(c/g-0.5);(a!==this.draw.lastI||b!==this.draw.lastJ)&&(void 0===this.draw.direction&&(a===this.draw.firstI?this.draw.direction='row':b===this.draw.firstJ&&(this.draw.direction='column')),('row'===this.draw.direction&&a===this.draw.firstI||'column'===this.draw.direction&&b===this.draw.firstJ)&&(this.paintCell(a,b),this.draw.lastI=a,this.draw.lastJ=b))}}},this.brushUp=()=>{delete this.isPressed,this.draw={}},this.theme.filledColor=h.violet,this.theme.correctColor=h.violet,Object.assign(this.theme,d),this.threshold=g,this.handleHintChange=i,this.m=a,this.n=b,this.grid=Array(this.m);for(let f=0;f<this.m;f+=1){this.grid[f]=Array(this.n);for(let a=0;a<this.n;a+=1)this.grid[f][a]=e.length?(e[f]&&e[f][a])?k.FILLED:k.EMPTY:Math.random()<this.threshold?k.FILLED:k.EMPTY}this.hints={row:Array(a),column:Array(b)};for(let f=0;f<this.m;f+=1)this.hints.row[f]=this.calculateHints('row',f),this.hints.row[f].isCorrect=!0;for(let f=0;f<this.n;f+=1)this.hints.column[f]=this.calculateHints('column',f),this.hints.column[f].isCorrect=!0;this.initCanvas(c),this.draw={},this.print(),this.handleHintChange(this.hints.row,this.hints.column)}initListeners(){this.listeners=[['mousedown',this.mousedown],['mousemove',this.mousemove],['mouseup',this.brushUp],['mouseleave',this.brushUp]]}paintCell(a,b){this.grid[a][b]=this.draw.brush,this.hints.row[a]=this.calculateHints('row',a),this.hints.row[a].isCorrect=!0,this.hints.column[b]=this.calculateHints('column',b),this.hints.column[b].isCorrect=!0,this.print(),this.handleHintChange(this.hints.row,this.hints.column)}refresh(){for(let a=0;a<this.m;a+=1)for(let b=0;b<this.n;b+=1)this.grid[a][b]=Math.random()<this.threshold?k.FILLED:k.EMPTY;for(let a=0;a<this.m;a+=1)this.hints.row[a]=this.calculateHints('row',a),this.hints.row[a].isCorrect=!0;for(let a=0;a<this.n;a+=1)this.hints.column[a]=this.calculateHints('column',a),this.hints.column[a].isCorrect=!0;this.print(),this.handleHintChange(this.hints.row,this.hints.column)}printController(){const{ctx:a}=this,{width:b,height:c}=this.canvas,f=g(b,c)/4,h=this.theme.filledColor;a.clearRect(2*b/3-1,2*c/3-1,b/3+1,c/3+1),a.save(),a.translate(0.7*b,0.7*c),a.drawImage(function(){const a=document.createElement('canvas'),b=f/10;a.width=f,a.height=f;const g=a.getContext('2d')||new CanvasRenderingContext2D;return g.translate(f/2,f/2),g.arc(0,0,f/2-b/2,e/2,e/3.9),g.lineWidth=b,g.strokeStyle=h,g.stroke(),g.beginPath(),g.moveTo((f/2+b)*d,(f/2+b)*d),g.lineTo((f/2-2*b)*d,(f/2-2*b)*d),g.lineTo((f/2-2*b)*d,(f/2+b)*d),g.closePath(),g.fillStyle=h,g.fill(),a}(),0,0),a.restore()}},a.Game=class extends i{constructor(a,b,c,{theme:d={},onSuccess:e=()=>{},onAnimationEnd:g=()=>{}}={}){super(),this.mousedown=(a)=>{const b=this.canvas.getBoundingClientRect(),c=a.clientX-b.left,e=a.clientY-b.top,g=2*b.width/3/(this.n+1),d=this.getLocation(c,e);if('controller'===d)this.switchBrush();else if('grid'===d){this.draw.firstI=f(e/g-0.5),this.draw.firstJ=f(c/g-0.5),this.draw.inverted=2===a.button;const b=this.grid[this.draw.firstI][this.draw.firstJ];let d=this.brush;this.draw.inverted&&(d=this.brush===k.FILLED?k.EMPTY:k.FILLED),(b===k.UNSET||d===b)&&(this.draw.mode=d===b?'empty':'filling',this.isPressed=!0,this.switchCell(this.draw.firstI,this.draw.firstJ)),this.draw.lastI=this.draw.firstI,this.draw.lastJ=this.draw.firstJ}},this.mousemove=(a)=>{if(this.isPressed){const b=this.canvas.getBoundingClientRect(),c=a.clientX-b.left,e=a.clientY-b.top,g=2*b.width/3/(this.n+1);if('grid'===this.getLocation(c,e)){const a=f(e/g-0.5),b=f(c/g-0.5);(a!==this.draw.lastI||b!==this.draw.lastJ)&&(void 0===this.draw.direction&&(a===this.draw.firstI?this.draw.direction='row':b===this.draw.firstJ&&(this.draw.direction='column')),('row'===this.draw.direction&&a===this.draw.firstI||'column'===this.draw.direction&&b===this.draw.firstJ)&&(this.switchCell(a,b),this.draw.lastI=a,this.draw.lastJ=b))}}},this.brushUp=()=>{delete this.isPressed,this.draw={}},this.theme.filledColor=h.blue,this.theme.wrongColor=h.grey,this.theme.isMeshed=!0,Object.assign(this.theme,d),this.handleSuccess=e,this.handleAnimationEnd=g,this.hints={row:a.slice(),column:b.slice()},this.removeNonPositiveHints(),this.m=this.hints.row.length,this.n=this.hints.column.length,this.grid=Array(this.m);for(let f=0;f<this.m;f+=1)this.grid[f]=Array(this.n).fill(k.UNSET);this.hints.row.forEach((a,b)=>{a.isCorrect=this.isLineCorrect('row',b)}),this.hints.column.forEach((a,b)=>{a.isCorrect=this.isLineCorrect('column',b)}),this.initCanvas(c),this.brush=k.FILLED,this.draw={},this.print()}calculateHints(a,b){const c=[],d=this.getSingleLine(a,b);return d.reduce((a,b)=>(b===k.FILLED&&c.push(a?c.pop()+1:1),b===k.FILLED),!1),c}initListeners(){this.listeners=[['mousedown',this.mousedown],['mousemove',this.mousemove],['mouseup',this.brushUp],['mouseleave',this.brushUp]]}switchBrush(){this.brush=this.brush===k.EMPTY?k.FILLED:k.EMPTY,this.printController()}switchCell(a,b){let c=this.brush;if(this.draw.inverted&&(c=this.brush===k.FILLED?k.EMPTY:k.FILLED),c===k.FILLED&&this.grid[a][b]!==k.EMPTY){this.grid[a][b]='filling'===this.draw.mode?k.FILLED:k.UNSET,this.hints.row[a].isCorrect=this.isLineCorrect('row',a),this.hints.column[b].isCorrect=this.isLineCorrect('column',b),this.print();const c=this.hints.row.every((a)=>!!a.isCorrect)&&this.hints.column.every((a)=>!!a.isCorrect);c&&this.succeed()}else c===k.EMPTY&&this.grid[a][b]!==k.FILLED&&(this.grid[a][b]='filling'===this.draw.mode?k.EMPTY:k.UNSET,this.print())}printCell(a){const{ctx:b}=this,c=2*this.canvas.width/3/(this.n+1);a===k.FILLED?(b.fillStyle=this.theme.filledColor,b.fillRect(0.05*-c,0.05*-c,1.1*c,1.1*c)):a===k.EMPTY?(b.strokeStyle=h.red,b.lineWidth=c/15,b.beginPath(),b.moveTo(0.3*c,0.3*c),b.lineTo(0.7*c,0.7*c),b.moveTo(0.3*c,0.7*c),b.lineTo(0.7*c,0.3*c),b.stroke()):void 0}printController(){function a(){c.save(),c.translate(j,0),c.fillStyle=this.theme.meshColor,c.fillRect(0,0,i,i),c.fillStyle=this.theme.filledColor,c.fillRect(l,l,m,m),c.restore()}function b(){c.save(),c.translate(0,j),c.fillStyle=this.theme.meshColor,c.fillRect(0,0,i,i),c.clearRect(l,l,m,m),c.strokeStyle=h.red,c.lineWidth=l,c.beginPath(),c.moveTo(0.3*i,0.3*i),c.lineTo(0.7*i,0.7*i),c.moveTo(0.3*i,0.7*i),c.lineTo(0.7*i,0.3*i),c.stroke(),c.restore()}const{ctx:c}=this,{width:d,height:e}=this.canvas,f=g(d,e)/4,i=3*f/4,j=f/4,l=f/20,m=i-2*l;c.clearRect(2*d/3-1,2*e/3-1,d/3+1,e/3+1),c.save(),c.translate(0.7*d,0.7*e),this.brush===k.FILLED?(b.call(this),a.call(this)):this.brush===k.EMPTY&&(a.call(this),b.call(this)),c.restore()}succeed(){function a(a){return 1+Math.pow(a-1,3)}this.handleSuccess(),this.listeners.forEach(([a,b])=>{this.canvas.removeEventListener(a,b)});const{ctx:b}=this,{width:c,height:d}=this.canvas,f=g(c,d)/4,i=b.getImageData(0,0,c,d),j=function(){var a=Math.SQRT2;const b=2*f,d=b/10,g=document.createElement('canvas');g.width=b,g.height=b;const i=g.getContext('2d')||new CanvasRenderingContext2D;return i.translate(b/3,5*b/6),i.rotate(-e/4),i.fillStyle=h.green,i.fillRect(0,0,d,-b*a/3),i.fillRect(0,0,2*(b*a)/3,-d),g}();let k=0;const l=()=>{b.putImageData(i,0,0),k+=0.03,b.globalAlpha=a(k),b.clearRect(2*c/3,2*d/3,c/3,d/3),b.drawImage(j,0.7*c-(1-a(k))*f/2,0.7*d-(1-a(k))*f/2,(2-a(k))*f,(2-a(k))*f),1>=k?requestAnimationFrame(l):this.handleAnimationEnd()};l()}},a}({});